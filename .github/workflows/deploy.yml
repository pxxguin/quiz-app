name: Deploy to GitHub Pages (Injecting Secrets)

on:
  push:
    branches:
      - main  # main ë¸Œëœì¹˜ì— í‘¸ì‹œë  ë•Œ ì‹¤í–‰
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v4
        
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'

      - name: Install dependencies
        run: npm install

      # ğŸš€ ë¹Œë“œ ë‹¨ê³„ì—ì„œ í™˜ê²½ ë³€ìˆ˜(Secrets) ì£¼ì…
      # VITE_ ì ‘ë‘ì‚¬ê°€ ë¶™ì€ Secret ê°’ë§Œ Vite ë¹Œë“œ ì‹œ ì•± ì½”ë“œì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.
      - name: Build project and Inject Secrets
        run: npm run build
        env:
          # GitHub Secretsì— ë“±ë¡ëœ ë³€ìˆ˜ëª…ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©
          VITE_SUPABASE_URL: ${{ secrets.VITE_SUPABASE_URL }}
          VITE_SUPABASE_ANON_KEY: ${{ secrets.VITE_SUPABASE_ANON_KEY }}

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist
          publish_branch: gh-pages